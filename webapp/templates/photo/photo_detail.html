{% extends "base.html" %}
{% block content %}
<div style="text-align: center;">
    <h2>{{ photo.caption }}</h2>
    <img src="{{ photo.image.url }}" alt="{{ photo.caption }}" style="width:200px; height:auto; border-radius:8px; object-fit:cover;">

    <div style="margin: 20px 0;">
        <p><strong>Автор:</strong> {{ photo.author.first_name|default:photo.author.username }}</p>
        <p><strong>Дата:</strong> {{ photo.created_at|date:"d.m.Y H:i" }}</p>
        {% if photo.album %}
            <p><strong>Альбом:</strong> <a href="{% url 'webapp:album_detail' photo.album.pk %}">{{ photo.album.title }}</a></p>
        {% endif %}
        <p><strong>Лайков:</strong>  <span id="photo-count-{{ photo.id }}">{{ photo.favorites_count }}</span></p>
    </div>

    {% if user.is_authenticated %}
        {% if photo.is_public %}
            <div style="margin: 10px 0;">
                {% if user in photo.favorited_by.all %}
                    <button id="add-photo-{{ photo.id }}"
                            onclick="addPhotoToFavorites({{ photo.id }})"
                            style="display: none; padding: 8px 15px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer;">
                        Добавить в избранное
                    </button>
                    <button id="remove-photo-{{ photo.id }}"
                            onclick="removePhotoFromFavorites({{ photo.id }})"
                            style="display: inline-block; padding: 8px 15px; background-color: #dc3545; color: white; border: 1px solid #dc3545; border-radius: 5px; cursor: pointer;">
                         Убрать из избранного
                    </button>
                {% else %}
                    <button id="add-photo-{{ photo.id }}"
                            onclick="addPhotoToFavorites({{ photo.id }})"
                            style="display: inline-block; padding: 8px 15px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer;">
                         Добавить в избранное
                    </button>
                    <button id="remove-photo-{{ photo.id }}"
                            onclick="removePhotoFromFavorites({{ photo.id }})"
                            style="display: none; padding: 8px 15px; background-color: #dc3545; color: white; border: 1px solid #dc3545; border-radius: 5px; cursor: pointer;">
                         Убрать из избранного
                    </button>
                {% endif %}
            </div>
        {% endif %}

        {% if user == photo.author %}
            <div style="margin-top: 15px;">
                <a href="{% url 'webapp:photo_edit' photo.pk %}" style="margin-left: 10px;">Редактировать</a>
                <a href="{% url 'webapp:photo_delete' photo.pk %}"
                   onclick="return confirm('Удалить фото?')"
                   style="margin-left: 10px; color: red;">Удалить</a>
            </div>

            <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
                <h4>Поделиться фотографией</h4>
                {% if photo.access_token %}
                    <p>Ссылка для доступа к фотографии:</p>
                    <div style="background-color: white; padding: 10px; border: 1px solid #ddd; border-radius: 3px; margin: 10px 0;">
                        <input type="text"
                               value="http://{{ request.get_host }}{% url 'webapp:photo_by_token' photo.access_token %}"
                               readonly
                               style="width: 100%; border: none; outline: none;"
                               onclick="this.select()">
                    </div>
                    <small style="color: #666;">Скопируйте эту ссылку, чтобы поделиться фотографией</small>
                {% else %}
                    <p>Создайте ссылку для доступа к фотографии (можно поделиться с другими пользователями):</p>
                    <a href="{% url 'webapp:generate_photo_link' photo.pk %}"
                       style="display: inline-block; padding: 8px 15px; background-color: #007bff; color: white; text-decoration: none; border-radius: 3px;">
                        Создать ссылку
                    </a>
                    <br><small style="color: #666;">Ссылка создается один раз и не может быть изменена</small>
                {% endif %}
            </div>
        {% endif %}
    {% endif %}
</div>

<div style="text-align: center; margin-top: 20px;">
    <a href="{% url 'webapp:photo_list' %}">← Вернуться к галерее</a>
</div>
{% endblock %}