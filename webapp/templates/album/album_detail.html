{% extends "base.html" %}
{% block content %}
    <div>
        <h1>{{ album.title }}</h1>
        <p><strong>Автор:</strong> {{ album.author.first_name|default:album.author.username }}</p>
        <p><strong>Создан:</strong> {{ album.created_at|date:"d.m.Y" }}</p>
        {% if album.description %}
            <p><strong>Описание:</strong> {{ album.description }}</p>
        {% endif %}
        <p><strong>Лайков:</strong><span id="album-count-{{ album.id }}">{{ album.favorited_by.count }}</span></p>

        {% if user.is_authenticated and album.is_public %}
            <div style="margin: 15px 0;">
                {% if user in album.favorited_by.all %}
                    <button id="add-album-{{ album.id }}"
                            onclick="addAlbumToFavorites({{ album.id }})"
                            style="display: none; padding: 8px 15px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer;">
                        Добавить альбом в избранное
                    </button>
                    <button id="remove-album-{{ album.id }}"
                            onclick="removeAlbumFromFavorites({{ album.id }})"
                            style="display: inline-block; padding: 8px 15px; background-color: #dc3545; color: white; border: 1px solid #dc3545; border-radius: 5px; cursor: pointer;">
                        Убрать альбом из избранного
                    </button>
                {% else %}
                    <button id="add-album-{{ album.id }}"
                            onclick="addAlbumToFavorites({{ album.id }})"
                            style="display: inline-block; padding: 8px 15px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 5px; cursor: pointer;">
                        Добавить альбом в избранное
                    </button>
                    <button id="remove-album-{{ album.id }}"
                            onclick="removeAlbumFromFavorites({{ album.id }})"
                            style="display: none; padding: 8px 15px; background-color: #dc3545; color: white; border: 1px solid #dc3545; border-radius: 5px; cursor: pointer;">
                        ★ Убрать альбом из избранного
                    </button>
                {% endif %}
            </div>
        {% endif %}

        {% if user == album.author %}
            <div style="margin: 20px 0;">
                <a href="{% url 'webapp:album_edit' album.pk %}">Редактировать альбом</a>
                <a href="{% url 'webapp:album_delete' album.pk %}"
                   onclick="return confirm('Удалить альбом и все его фото?')"
                   style="margin-left: 10px; color: red;">Удалить альбом</a>
            </div>
        {% endif %}
    </div>

    <h3>Фотографии в альбоме</h3>
    <div class="photo-grid">
        {% for photo in photos_page %}
            <div class="photo-item">
                <a href="{% url 'webapp:photo_detail' photo.pk %}">
                    <img src="{{ photo.image.url }}" alt="{{ photo.caption }}"
                         style="width:200px; height:auto; border-radius:8px; object-fit:cover;">
                </a>
                <p>{{ photo.caption|truncatechars:30 }}</p>

                <div style="margin-top: 10px;">
                    <small> <span id="photo-count-{{ photo.id }}">{{ photo.favorites_count }}</span></small>

                    {% if user.is_authenticated and photo.is_public %}
                        <div style="margin-top: 5px;">
                            {% if user in photo.favorited_by.all %}
                                <button id="add-photo-{{ photo.id }}"
                                        onclick="addPhotoToFavorites({{ photo.id }})"
                                        style="display: none; padding: 3px 6px; font-size: 11px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; cursor: pointer;">
                                    Добавить фото в избранное
                                </button>
                                <button id="remove-photo-{{ photo.id }}"
                                        onclick="removePhotoFromFavorites({{ photo.id }})"
                                        style="display: inline-block; padding: 3px 6px; font-size: 11px; background-color: #dc3545; color: white; border: 1px solid #dc3545; border-radius: 3px; cursor: pointer;">
                                    Убрать фото в избранное
                                </button>
                            {% else %}
                                <button id="add-photo-{{ photo.id }}"
                                        onclick="addPhotoToFavorites({{ photo.id }})"
                                        style="display: inline-block; padding: 3px 6px; font-size: 11px; background-color: #f0f0f0; border: 1px solid #ccc; border-radius: 3px; cursor: pointer;">
                                    Добавить фото в избранное

                                </button>
                                <button id="remove-photo-{{ photo.id }}"
                                        onclick="removePhotoFromFavorites({{ photo.id }})"
                                        style="display: none; padding: 3px 6px; font-size: 11px; background-color: #dc3545; color: white; border: 1px solid #dc3545; border-radius: 3px; cursor: pointer;">
                                    убрать фото в избранное

                                </button>
                            {% endif %}
                        </div>
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <p>В альбоме пока нет фотографий.</p>
        {% endfor %}
    </div>

    {% if photos_page.has_other_pages %}
        <div class="pagination">
            {% if photos_page.has_previous %}
                <a href="?page=1">&laquo; первая</a>
                <a href="?page={{ photos_page.previous_page_number }}">предыдущая</a>
            {% endif %}

            <span class="current">
            Страница {{ photos_page.number }} из {{ photos_page.paginator.num_pages }}
        </span>

            {% if photos_page.has_next %}
                <a href="?page={{ photos_page.next_page_number }}">следующая</a>
                <a href="?page={{ photos_page.paginator.num_pages }}">последняя &raquo;</a>
            {% endif %}
        </div>
    {% endif %}

    <div style="margin-top: 30px;">
        <a href="{% url 'webapp:photo_list' %}">← Вернуться к галерее</a>
    </div>
{% endblock %}